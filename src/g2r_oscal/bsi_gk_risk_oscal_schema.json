{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://example.com/oscal/bsi-grundschutz-catalog.schema.json",
  "title": "BSI Grundschutz Catalog OSCAL Schema",
  "description": "A JSON schema for representing the BSI Grundschutz Kompendium in an OSCAL catalog format. It extends the standard OSCAL model with properties for BSI-specific levels, implementation phases, and control maturity.",
  "type": "object",
  "required": ["catalog"],
  "properties": {
    "catalog": {
      "$ref": "#/definitions/oscal-catalog"
    }
  },
  "definitions": {
    "oscal-catalog": {
      "title": "OSCAL Catalog",
      "description": "A collection of security and privacy controls based on the official OSCAL schema.",
      "type": "object",
      "required": ["uuid", "metadata", "groups"],
      "properties": {
        "uuid": {
          "$ref": "#/definitions/uuid"
        },
        "metadata": {
          "$ref": "#/definitions/metadata"
        },
        "groups": {
          "type": "array",
          "description": "The main groups of the BSI Grundschutz Kompendium.",
          "items": {
            "$ref": "#/definitions/mainGroup"
          }
        },
        "back-matter": {
          "$ref": "#/definitions/back-matter"
        }
      }
    },
    "metadata": {
      "type": "object",
      "required": ["title", "last-modified", "version", "oscal-version"],
      "properties": {
        "title": {
          "type": "string",
          "description": "The title of this BSI OSCAL catalog."
        },
        "last-modified": {
          "type": "string",
          "format": "date-time",
          "description": "The date and time the catalog was last modified."
        },
        "version": {
          "type": "string",
          "description": "The version of this BSI catalog."
        },
        "oscal-version": {
          "type": "string",
          "const": "1.1.2",
          "description": "The OSCAL version this catalog is based on."
        },
        "roles": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/role"
          }
        },
        "parties": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/party"
          }
        },
        "responsible-parties": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/responsible-party"
          }
        }
      }
    },
    "mainGroup": {
      "type": "object",
      "description": "A main group corresponding to a BSI Grundschutz layer, e.g., 'OPS: Betrieb'.",
      "required": ["id", "title", "groups"],
      "properties": {
        "id": {
          "$ref": "#/definitions/token"
        },
        "class": {
          "$ref": "#/definitions/token"
        },
        "title": {
          "type": "string"
        },
        "groups": {
          "type": "array",
          "description": "A list of 'Baustein-Groups' within this main group.",
          "items": {
            "$ref": "#/definitions/bausteinGroup"
          }
        }
      }
    },
    "bausteinGroup": {
      "type": "object",
      "description": "A group corresponding to a specific BSI 'Baustein'.",
      "required": ["id", "title", "controls"],
      "properties": {
        "id": {
          "$ref": "#/definitions/token"
        },
        "class": {
          "$ref": "#/definitions/token"
        },
        "title": {
          "type": "string"
        },
        "parts": {
          "type": "array",
          "description": "Provides additional prose context, such as usage guidelines or risk analysis, which are OSCAL-compliant.",
          "items": {
            "$ref": "#/definitions/basePart"
          }
        },
        "controls": {
          "type": "array",
          "description": "The controls defined within this Baustein.",
          "items": {
            "$ref": "#/definitions/bsiControl"
          }
        }
      }
    },
    "bsiControl": {
      "type": "object",
      "description": "A BSI requirement, acting as a container for maturity-level-specific controls.",
      "required": ["id", "title", "props", "controls"],
      "properties": {
        "id": {
          "$ref": "#/definitions/token"
        },
        "title": {
          "type": "string"
        },
        "props": {
          "type": "array",
          "items": {
            "anyOf": [
              {
                "$ref": "#/definitions/levelProp"
              },
              {
                "$ref": "#/definitions/phaseProp"
              },
              {
                "$ref": "#/definitions/riskAnalysisProp"
              }
            ]
          },
          "minItems": 2
        },
        "controls": {
          "type": "array",
          "description": "Nested controls representing different maturity levels.",
          "items": {
            "$ref": "#/definitions/maturityControl"
          },
          "minItems": 1
        }
      }
    },
    "levelProp": {
      "type": "object",
      "required": ["name", "value"],
      "properties": {
        "name": {
          "type": "string",
          "const": "level"
        },
        "value": {
          "type": "string",
          "enum": ["1", "3", "5"],
          "description": "BSI Schutzbedarf Level: 1 (Basis), 3 (Standard), 5 (Erh√∂hter Schutzbedarf)."
        },
        "ns": {
          "type": "string",
          "format": "uri",
          "const": "https://example.com/oscal/bsi-ns"
        }
      }
    },
    "phaseProp": {
      "type": "object",
      "required": ["name", "value"],
      "properties": {
        "name": {
          "type": "string",
          "const": "phase"
        },
        "value": {
          "type": "string",
          "enum": [
            "Initiation",
            "Risk Assessment",
            "Risk Treatment",
            "Implementation",
            "Operation",
            "Audit",
            "Improvement"
          ],
          "description": "Phase of ISMS implementation."
        },
        "ns": {
          "type": "string",
          "format": "uri",
          "const": "https://example.com/oscal/bsi-ns"
        }
      }
    },
    "riskAnalysisProp": {
      "type": "object",
      "required": ["name", "value"],
      "properties": {
        "name": {
          "type": "string",
          "const": "risk-analysis"
        },
        "value": {
          "type": "string",
          "enum": ["true", "false"]
        },
        "ns": {
          "type": "string",
          "format": "uri",
          "const": "https://example.com/oscal/bsi-ns"
        }
      }
    },
    "maturityControl": {
      "type": "object",
      "description": "A control detailing a specific maturity level of implementation.",
      "required": ["id", "title", "props", "parts"],
      "properties": {
        "id": {
          "$ref": "#/definitions/token"
        },
        "title": {
          "type": "string"
        },
        "props": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/maturityLevelProp"
          },
          "minItems": 1
        },
        "parts": {
          "type": "array",
          "description": "The different parts of the control, including the control text, implementation notes, and audit procedures.",
          "minItems": 3,
          "items": {
            "$ref": "#/definitions/basePart"
          },
          "allOf": [
            {
              "contains": {
                "$ref": "#/definitions/controlTextPart"
              },
              "minContains": 1,
              "maxContains": 1
            },
            {
              "contains": {
                "$ref": "#/definitions/implementationNotePart"
              },
              "minContains": 1,
              "maxContains": 1
            },
            {
              "contains": {
                "$ref": "#/definitions/auditProcedurePart"
              },
              "minContains": 1,
              "maxContains": 1
            }
          ]
        }
      }
    },
    "maturityLevelProp": {
      "type": "object",
      "required": ["name", "value"],
      "properties": {
        "name": {
          "type": "string",
          "const": "maturity-level"
        },
        "value": {
          "type": "string",
          "enum": [
            "Partial",
            "Foundational",
            "Defined",
            "Enhanced",
            "Comprehensive"
          ],
          "description": "Maturity level describing the quality of the implemented measure."
        },
        "ns": {
          "type": "string",
          "format": "uri",
          "const": "https://example.com/oscal/bsi-ns"
        }
      }
    },
    "basePart": {
      "type": "object",
      "required": ["name", "prose"],
      "properties": {
        "name": {
          "$ref": "#/definitions/token"
        },
        "title": {
          "type": "string",
          "description": "An optional name given to the part, which may be used by a tool for display and navigation."
        },
        "prose": {
          "type": "string",
          "description": "The detailed description of the part."
        }
      },
      "additionalProperties": false
    },
    "controlTextPart": {
      "allOf": [
        {
          "$ref": "#/definitions/basePart"
        },
        {
          "properties": {
            "name": {
              "type": "string",
              "const": "control"
            },
            "prose": {
              "description": "The main text of the control requirement for this maturity level."
            }
          }
        }
      ]
    },
    "implementationNotePart": {
      "allOf": [
        {
          "$ref": "#/definitions/basePart"
        },
        {
          "properties": {
            "name": {
              "type": "string",
              "const": "implementation_note"
            },
            "prose": {
              "description": "Detailed notes on how to implement the control."
            }
          }
        }
      ]
    },
    "auditProcedurePart": {
      "allOf": [
        {
          "$ref": "#/definitions/basePart"
        },
        {
          "properties": {
            "name": {
              "type": "string",
              "const": "audit_procedure"
            },
            "prose": {
              "description": "Detailed procedures for auditing the control implementation."
            }
          }
        }
      ]
    },
    "uuid": {
      "type": "string",
      "format": "uuid",
      "description": "A globally unique identifier for this catalog instance."
    },
    "token": {
      "type": "string",
      "pattern": "^\\S+$",
      "description": "A non-empty string without leading or trailing whitespace."
    },
    "back-matter": {
      "type": "object",
      "properties": {
        "resources": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/resource"
          }
        }
      }
    },
    "resource": {
      "type": "object",
      "required": ["uuid"],
      "properties": {
        "uuid": {
          "$ref": "#/definitions/uuid"
        },
        "rlinks": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/rlink"
          }
        }
      }
    },
    "rlink": {
      "type": "object",
      "required": ["href"],
      "properties": {
        "href": {
          "type": "string",
          "format": "uri-reference"
        },
        "media-type": {
          "type": "string"
        }
      }
    },
    "role": {
      "type": "object",
      "required": ["id", "title"],
      "properties": {
        "id": {
          "$ref": "#/definitions/token"
        },
        "title": {
          "type": "string"
        }
      }
    },
    "party": {
      "type": "object",
      "required": ["uuid", "type"],
      "properties": {
        "uuid": {
          "$ref": "#/definitions/uuid"
        },
        "type": {
          "type": "string",
          "enum": ["person", "organization"]
        },
        "name": {
          "type": "string"
        }
      }
    },
    "responsible-party": {
      "type": "object",
      "required": ["role-id", "party-uuids"],
      "properties": {
        "role-id": {
          "$ref": "#/definitions/token"
        },
        "party-uuids": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/uuid"
          }
        }
      }
    }
  }
}